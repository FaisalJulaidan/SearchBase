{% extends "admin/base.html" %}

{% block headlinks %}
    <title>Analytics </title>

    <!-- Bootstrap -->
    <link href="../../static/vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="../../static/vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <!-- NProgress -->
    <link href="../../static/vendors/nprogress/nprogress.css" rel="stylesheet">
    <!-- iCheck -->
    <link href="../../static/vendors/iCheck/skins/flat/green.css" rel="stylesheet">

    <!-- bootstrap-progressbar -->
    <link href="../../static/vendors/bootstrap-progressbar/css/bootstrap-progressbar-3.3.4.min.css" rel="stylesheet">
    <!-- JQVMap -->
    <link href="../../static/vendors/jqvmap/dist/jqvmap.min.css" rel="stylesheet"/>
    <!-- bootstrap-daterangepicker -->
    <link href="../../static/vendors/bootstrap-daterangepicker/daterangepicker.css" rel="stylesheet">

    <!-- Custom Theme Style -->
    <link href="../../static/build/css/custom.min.css" rel="stylesheet">
{% endblock %}

{% block content %}
    <div class="right_col" role="main">
    <div class="">
        <div class="page-title">
            <div class="title_left">
                <h3>Analytics
                    <small>Here are the statistics of your assistant</small>
                </h3>
            </div>
        </div>
        <div class="clearfix"></div>
        <div id="pasteDiv" class="row">
            <li> Export to Excel</li>
            <br/>
            <button id="btnExport" onclick="fnExcelReport();"> EXPORT</button>
            <br>
            <iframe id="txtArea1" style="display:none"></iframe>
            <br/>
            <br/>
            <h2>General Data</h2>
            <br/>
            <div class="analytics_line">
                <!-- First chart -->
                <div style="width:350px; height:200px;">
                    <canvas id="putcharthere1" style="width:350px; height:0px;"></canvas>
                </div>

                <!-- Second chart -->
                <div style="width:350px; height:200px;">
                    <canvas id="putcharthere2" style="width:350px; height:0px;"></canvas>
                </div>

                <!-- Third chart -->
                <div style="width:350px; height:200px;">
                    <canvas id="putcharthere3" style="width:350px; height:0px"></canvas>
                </div>
                <div class="clearfix"></div>
            </div>
            <h2>Users over time</h2>
            <br/>
            <div class="analytics_line">
                <!-- First chart -->
                <div style="width:700px; height:300px;">
                    <canvas id="putcharthere4" style="width:350px; height:0px;"></canvas>
                </div>
                <div class="clearfix"></div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascript %}
    <!-- jQuery -->
    <script src="../../static/vendors/jquery/dist/jquery.min.js"></script>
    <!-- Bootstrap -->
    <script src="../../static/vendors/bootstrap/dist/js/bootstrap.min.js"></script>
    <!-- FastClick -->
    <script src="../../static/vendors/fastclick/lib/fastclick.js"></script>
    <!-- NProgress -->
    <script src="../../static/vendors/nprogress/nprogress.js"></script>
    <!-- Chart.js -->
    <script src="../../static/vendors/Chart.js/dist/Chart.min.js"></script>
    <!-- gauge.js -->
    <script src="../../static/vendors/gauge.js/dist/gauge.min.js"></script>
    <!-- bootstrap-progressbar -->
    <script src="../../static/vendors/bootstrap-progressbar/bootstrap-progressbar.min.js"></script>
    <!-- iCheck -->
    <script src="../../static/vendors/iCheck/icheck.min.js"></script>
    <!-- Skycons -->
    <script src="../../static/vendors/skycons/skycons.js"></script>
    <!-- Flot -->
    <script src="../../static/vendors/Flot/jquery.flot.js"></script>
    <script src="../../static/vendors/Flot/jquery.flot.pie.js"></script>
    <script src="../../static/vendors/Flot/jquery.flot.time.js"></script>
    <script src="../../static/vendors/Flot/jquery.flot.stack.js"></script>
    <script src="../../static/vendors/Flot/jquery.flot.resize.js"></script>
    <!-- Flot plugins -->
    <script src="../../static/vendors/flot.orderbars/js/jquery.flot.orderBars.js"></script>
    <script src="../../static/vendors/flot-spline/js/jquery.flot.spline.min.js"></script>
    <script src="../../static/vendors/flot.curvedlines/curvedLines.js"></script>
    <!-- DateJS -->
    <script src="../../static/vendors/DateJS/build/date.js"></script>
    <!-- JQVMap -->
    <script src="../../static/vendors/jqvmap/dist/jquery.vmap.js"></script>
    <script src="../../static/vendors/jqvmap/dist/maps/jquery.vmap.world.js"></script>
    <script src="../../static/vendors/jqvmap/examples/js/jquery.vmap.sampledata.js"></script>
    <!-- bootstrap-daterangepicker -->
    <script src="../../static/vendors/moment/min/moment.min.js"></script>
    <script src="../../static/vendors/bootstrap-daterangepicker/daterangepicker.js"></script>

    <!-- Custom Theme Scripts -->
    <script src="../../static/build/js/custom.min.js"></script>


    <script src="../../static/js/cookies.js"></script>
    <!-- <script src='../static/js/Chart.min.js'></script> -->
    <script src="https://cdn.anychart.com/releases/8.0.0/js/anychart-base.min.js"></script>
    <script>

        //  Start of the chart code
        var chartData = {
            labels: [{% for item in data %}
                {%if ";" not in item[0] %}
                    "{{item[0]}}",
                {% endif %}
            {% endfor %}],
            datasets: [{
                label: 'Assistant Used',
                fill: true,
                lineTension: 0.1,
                backgroundColor: "rgb(255,0,0)",
                borderColor: "rgb(255,0,0)",
                borderCapStyle: 'butt',
                borderDash: [],
                borderDashOffset: 0.0,
                borderJoinStyle: 'miter',
                pointBorderColor: "rgba(75,192,192,1)",
                pointBackgroundColor: "#fff",
                pointBorderWidth: 1,
                pointHoverRadius: 5,
                pointHoverBackgroundColor: "rgba(75,192,192,1)",
                pointHoverBorderColor: "rgba(220,220,220,1)",
                pointHoverBorderWidth: 2,
                pointRadius: 1,
                pointHitRadius: 10,
                data: [{% for item in data %}
                    {%if ";" not in item[0] %}
                        {{item[1]}},
                    {% endif %}
                {% endfor %}],
                spanGaps: false
            }]
        }
        var chartdiv = document.getElementById("putcharthere1").getContext("2d");
        new Chart(chartdiv, {
            data: chartData,
            type: 'bar',
        });

        //  End of the chart code

        var chartData = {
            labels: [{% for item in data %}
                {%if ";" not in item[0] %}
                    "{{item[0]}}",
                {% endif %}
            {% endfor %}],
            datasets: [{
                label: 'Questions Answered',
                fill: true,
                lineTension: 0.1,
                backgroundColor: "rgb(0,191,255)",
                borderColor: "rgb(0,191,255)",
                borderCapStyle: 'butt',
                borderDash: [],
                borderDashOffset: 0.0,
                borderJoinStyle: 'miter',
                pointBorderColor: "rgba(75,192,192,1)",
                pointBackgroundColor: "#fff",
                pointBorderWidth: 1,
                pointHoverRadius: 5,
                pointHoverBackgroundColor: "rgba(75,192,192,1)",
                pointHoverBorderColor: "rgba(220,220,220,1)",
                pointHoverBorderWidth: 2,
                pointRadius: 1,
                pointHitRadius: 10,
                data: [{% for item in data %}
                    {%if ";" not in item[0] %}
                        {{item[2]}},
                    {% endif %}
                {% endfor %}],
                spanGaps: false
            }]
        }
        var chartdiv = document.getElementById("putcharthere2").getContext("2d");
        new Chart(chartdiv, {
            data: chartData,
            type: 'bar',
        });


        var chartData = {
            labels: [{% for item in data %}
                {%if ";" not in item[0] %}
                    "{{item[0]}}",
                {% endif %}
            {% endfor %}],
            datasets: [{
                label: 'Products Returned',
                fill: true,
                lineTension: 0.1,
                backgroundColor: "rgb(255,255,0)",
                borderColor: "rgb(255,255,0)",
                borderCapStyle: 'butt',
                borderDash: [],
                borderDashOffset: 0.0,
                borderJoinStyle: 'miter',
                pointBorderColor: "rgba(75,192,192,1)",
                pointBackgroundColor: "#fff",
                pointBorderWidth: 1,
                pointHoverRadius: 5,
                pointHoverBackgroundColor: "rgba(75,192,192,1)",
                pointHoverBorderColor: "rgba(220,220,220,1)",
                pointHoverBorderWidth: 2,
                pointRadius: 1,
                pointHitRadius: 10,
                data: [{% for item in data %}
                    {%if ";" not in item[0] %}
                        {{item[3]}},
                    {% endif %}
                {% endfor %}],
                spanGaps: false
            }]
        }
        var chartdiv = document.getElementById("putcharthere3").getContext("2d");
        new Chart(chartdiv, {
            data: chartData,
            type: 'bar',
        });


        //  Start of the chart code
        var chartData = {
            labels: [{% for item in data %}
                {%if ";" in item[0] %}
                    "Week " + "{{item[0]}}".split(";")[1] + " of " + "{{item[0]}}".split(";")[0],
                {% endif %}
            {% endfor %}],
            datasets: [{
                label: 'Assistant Used',
                fill: false,
                lineTension: 0.1,
                backgroundColor: "rgb(50,205,50)",
                borderColor: "rgb(50,205,50)",
                borderCapStyle: 'butt',
                borderDash: [],
                borderDashOffset: 0.0,
                borderJoinStyle: 'miter',
                pointBorderColor: "rgba(75,192,192,1)",
                pointBackgroundColor: "#fff",
                pointBorderWidth: 1,
                pointHoverRadius: 5,
                pointHoverBackgroundColor: "rgba(75,192,192,1)",
                pointHoverBorderColor: "rgba(220,220,220,1)",
                pointHoverBorderWidth: 2,
                pointRadius: 1,
                pointHitRadius: 10,
                data: [{% for item in data %}
                    {%if ";" in item[0] %}
                        {{item[1]}},
                    {% endif %}
                {% endfor %}],
                spanGaps: false
            }]
        }
        var chartdiv = document.getElementById("putcharthere4").getContext("2d");
        new Chart(chartdiv, {
            data: chartData,
            type: 'line',
        });

        //  End of the chart code


        //Create table for Excel export
        var tableString = "<table><tr><th>Date</th><th>Assistant Opened</th><th>Questions Answered</th><th>Products Returned</th></tr>";
        {% for item in data %}
            tableString += "<tr>"
            {%for value in item%}
                tableString += "<td>{{value}}</td>"
            {%endfor%}
            tableString += "</tr>"
        {%endfor%}
        function fnExcelReport() {
            // var tab_text="<table border='2px'><tr bgcolor='#87AFC6'>";
            // var textRange; var j=0;
            // tab = document.getElementById('headerTable'); // id of table
            //
            // for(j = 0 ; j < tab.rows.length ; j++)
            // {
            //     tab_text=tab_text+tab.rows[j].innerHTML+"</tr>";
            //     //tab_text=tab_text+"</tr>";
            // }
            //
            // tab_text=tab_text+"</table>";
            tab_text = tableString;
            tab_text = tab_text.replace(/<A[^>]*>|<\/A>/g, "");//comment if u want links in your table
            tab_text = tab_text.replace(/<img[^>]*>/gi, ""); // comment if u want images in your table
            tab_text = tab_text.replace(/<input[^>]*>|<\/input>/gi, ""); // comment if you want input params

            var ua = window.navigator.userAgent;
            var msie = ua.indexOf("MSIE ");

            if (msie > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./))      // If Internet Explorer
            {
                txtArea1.document.open("txt/html", "replace");
                txtArea1.document.write(tab_text);
                txtArea1.document.close();
                txtArea1.focus();
                sa = txtArea1.document.execCommand("SaveAs", true, "Say Thanks to Sumit.xls");
            }
            else                 //other browser not tested on IE 11
                sa = window.open('data:application/vnd.ms-excel,' + encodeURIComponent(tab_text));

            return (sa);
        }
    </script>
{% endblock %}