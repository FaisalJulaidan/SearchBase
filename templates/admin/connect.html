{% extends "admin/base.html" %}

{% block title %}Home{% endblock %}

{% block content %}
    <div class="right_col" role="main">
        <!-- top tiles -->

        <div class="row">
            <div class="col-md-12 col-sm-12 col-xs-12">
                <div class="x_panel">
                    <style>
                        legend {
                            padding: 3px 6px;
                        }

                        input {
                            margin: .4rem;
                        }

                    </style>
                    <fieldset>
                        <legend class="h3">Choose circle and icon colors</legend>

                        <div style="display: -webkit-inline-box;">

                            <div style="margin: 10px">
                                <input type="color" id="icon" name="color"
                                       value="#ffffff"/>
                                <label for="icon">Icon</label>
                            </div>

                            <div style="margin: 10px">
                                <input type="color" id="circle" name="color"
                                       value="#4B5B71"/>
                                <label for="circle">Circle</label>
                            </div>
                        </div>

                    </fieldset>

                </div>
                <div class="x_panel" style="height:500px;">
                    <div class="col-md-12">
                        <legend class="h3">Connecting your assistant.</legend>
                        <p>
                            To Connect your assistant, you must paste the pre-made code into any part of your HTML source code.
                        </p>

                        <strong>
                            <textarea style="width:600px; height:90px;" id="URL_id" readonly>
                            </textarea>
                        </strong>
                        <br />
                        <br />


                        <p> To deploy your assistant, simply copy the line above and paste it in the page in which you would like your bot to operate in.</p>

                        <button  id="copyURLBtn" class="btn btn-success">Copy URL</button>
                        <br />
                        <button  id="testIntegrationBtn" class="btn btn-success">Test Assistant Pop Up</button>
                        <div id="integratePaste"></div>
                        <h5>The pop up will appear after the time set just like it would on your website.</h5>
                        <br />
                        <br />

                        <p>
                            <strong>
                                For better performance, paste the line of code within the elements within the code of your website.
                                <xmp style="margin-left:-200px">
                                    <body>
                                        <The line above goes here>
                                    </body>
                                </xmp>
                            </strong>
                        <strong>Note: </strong>It is important to notify users about their use with the chatbot. You can do this by adding this in your 'terms & conditions' <br />
                            page or by asking them through the chatbot that they are happy for you to collect their data.
                        </p>

                        </p>
                    </div>
                </div>
            </div>
        </div>
        <!-- /top tiles -->
        <br/>
    </div>
{% endblock %}


{% block customJS %}
    <script>
        window.onload = function () {
            if (prev_handler)
                prev_handler();

            var colon = "";
            if (window.location.port !== "")
                colon = ":";

            let $script = $('<script src=\"' + window.location.protocol + '//' + window.location.hostname + colon  + window.location.port +
                '/userdownloads/widget.js\" data-name=\"tsb-widget\" data-id={{ assistantID }} data-icon="#fff" data-circle="#4B5B71" async defer>');

            $('input#icon').on('change', (e) => {
                $script.attr('data-icon', $('input#icon').val());
                $('#URL_id').first().text($script[0].outerHTML)
            });

            $('input#circle').on('change', (e) => {
                $script.attr('data-circle', $('input#circle').val());
                $('#URL_id').first().text($script[0].outerHTML)
            });

            // paste the script tag inside textarea tag
            document.getElementById("URL_id").innerHTML = $script.prop('outerHTML');



            function copyURL() {
            /* Get the text field */
            var copyText = document.getElementById("URL_id");

            /* Select the text field */
            copyText.select();

            /* Copy the text inside the text field */
            document.execCommand("copy");
            }
            {#.appendTo(document.body)#}
            //var script = undefined;
            function testIntegration() {
                var $script = $(document.getElementById("URL_id").value);

                // delete the old added script tag if exists
                if(document.querySelector('script[data-name="tsb-widget"][data-id]')) {
                    console.log("Delete old");
                    document.querySelector('script[data-name="tsb-widget"][data-id]').remove();
                }



                $("#TSB-container").remove();
                $script.appendTo(document.body);

            }

            document.getElementById('testIntegrationBtn').addEventListener('click', testIntegration);
            document.getElementById('copyURLBtn').addEventListener('click', copyURL);
        }


    </script>


{% endblock %}
