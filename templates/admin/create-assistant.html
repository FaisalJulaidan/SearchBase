{% extends "admin/base.html" %}

{% block title %}Assistant{% endblock %}

{% block content %}
    <div class="right_col" role="main">
        <div class="">
            <div class="clearfix"></div>
            <div class="row">
                <div class="col-md-12 col-sm-12 col-xs-12">
                    <div class="x_panel">
                        <div class="x_title">
                            <h1>Create your new assistant</h1>
                            <ul class="nav navbar-right panel_toolbox"></ul>
                            <div class="clearfix"></div>
                            <br>
                            <form id="assistantForm">
                                <h4>
                                    Enter a name for your assistant to easily identify it in the dashboard. Must be
                                    unique.<span class="required">*</span>
                                </h4>
                                <div class="col-md-9 col-sm-9 col-xs-12">
                                    <input name="name" type="text"
                                           id="name"
                                           required="required" class="form-control col-md-5 col-xs-10">
                                </div>
                                <br>
                                <br>
                                <br>
                                <h4>Enter your welcome message <span class="required">*</span></h4>
                                <div class="col-md-9 col-sm-9 col-xs-12">
                                    <input name="welcome-message" type="text"
                                           id="welcome-message"
                                           required="required" class="form-control col-md-5 col-xs-10">
                                </div>
                                <br>
                                <br>
                                <br>

                                <!--<h4>Select the assistant category.</h4>
        <select id="category-select">
            <option value="recruitment">Recruitment</option>
            <option value="property">Property</option>
        </select>
        <br>
        <br>
        <br>-->

                                <h4>Would you like the assistant to automatically open for the user?</h4>
                                <label class="switch">
                                    <input id="switch-autopop" name="switch-autopop" type="checkbox"
                                           onclick="switchchecked()">
                                    <span class="slider round"></span>
                                </label>
                                <br>
                                <br>
                                <div id="popup-time" hidden>
                                    <h4>
                                        How long should the chat bot wait before opening?
                                        <small> *Time in Seconds</small>
                                    </h4>
                                    <input name="timeto-autopop" style="width:50px"
                                           class="form-control col-md-5 col-xs-10"
                                           id="bot_time" type="text"
                                            value='0'>
                                    <br>
                                    <br>
                                    <br>
                                </div>

                                <!-- Submit button -->
                                <button class="btn btn-success">Submit</button>
                            </form>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block customJS %}
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

  <script>
      function switchchecked() {
          show = document.getElementById("switch-autopop").checked;
          popupDiv = document.getElementById("popup-time");
          time = document.getElementById("bot_time");
          popupDiv.hidden = !show;
          if (!show){
              time.value = 0
          }
          console.log(time.value);
      }

       $(document).on('submit', '#assistantForm', function (e) {
        e.preventDefault();
        createAssistant(this);
    });

      function createAssistant(){
        console.log("Create Assistant");
        $.ajax({
            url: '/admin/assistant',
            type: "POST",
            dataType: "json",
            data: $('#assistantForm').serialize()
        }).done(function (res) {
            console.log(res);
            swal("Success!", "User has been created successfully", "success").then((value) => {
              document.location = "/admin/assistant/" + res.data + "/settings"
            });
        }).fail(function (res) {
            var resJson = JSON.parse(res.responseText);
            swal("Error!", resJson.msg, "error").then((value) => {
            });
        });
            }
  </script>
{% endblock %}
